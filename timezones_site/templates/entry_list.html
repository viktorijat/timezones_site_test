{% extends 'log_in_register.html' %}

{{% block javascript %}


    $(".delete-button").click(function(event){
        alert("okkk")
        alert(id, urr)
        id = $(this).data('url');
        alert(id)

        urrr = "profile/delete_entry/" + id

    });

    $(".edit-button").click(function(event){
        alert("okkk");
        alert(id, urr);
        id = $(this).data('url');
        alert(id)

        urrr = "profile/edit_by_id/" + id

    });


<<<<<<< HEAD
    function deleteentry(entry_id, this_table_row) {

        //element = document.getElementById(this_table_row);
        //alert(entry_id);
=======
    function delete_entry_func(entry_id, this_table_row) {

        element = document.getElementById(this_table_row);
        //alert(this_table_row)
>>>>>>> 167299c35b3df50037a61277ccea4cc5db38d3e8
        urll = "profile/delete_by_id/?query=" + entry_id
        $.ajax({
            url: urll,
            type: 'DELETE',
            data: {'id': entry_id},
            statusCode: {
                401: function() {alert( "no entries found" );},
                200: function() {//alert( "entry deleted" );
                //alert($(element));
                this_table_row.remove();
                },
            },

        });
    }

<<<<<<< HEAD


    function editentry(i, entry_id, tdA, tdB, tdO){

        var new_entry_name = tdA.value;
        var new_city_name = tdB.value;
        var new_offset = tdO.value;

=======
    $("#button_change_entry").click(function(){

        var entry_id = $("#edit_entry_id").val()
        var new_entry_name = $("#edit_entry_name").val();
        var new_city_name = $("#edit_city_name").val();
        var new_offset = $("#edit_offset").val();
>>>>>>> 167299c35b3df50037a61277ccea4cc5db38d3e8

        urll = "profile/edit_by_id/?query=" + entry_id

        //urll = "edit_by_id/?query=" + entry_id
        $.ajax({

            url: urll,
            type: 'UPDATE',
            data: {'entry_id': entry_id, 'entry_name': new_entry_name, 'city_name': new_city_name, 'offset': new_offset},
            dataType: 'json',
            statusCode:
            {
                405: function() {console.log("method not allowed");},
                404: function() {console.log("not found");},
                200: function() {console.log("entry changed");},
                204: function() {console.log("no content to show");},
            },
            success: function (data) {

                show_all_entries(data);
                $("body").append(data.success);

            },
        });
<<<<<<< HEAD





    }

=======
    });

    function edit_entry_div_activate(entry_idd, entry_namee, city_namee, offset){

        //alert(entry_idd);

        //$("#edit_entry").show();
        document.getElementById("edit_entry").style.display = "table-cell";
        //alert(entry_idd);
        document.getElementById("edit_entry_id").value = entry_idd;
        document.getElementById("edit_entry_name").value = entry_namee;
        document.getElementById("edit_city_name").value = city_namee;
        document.getElementById("edit_offset").value = offset;

    }

    $("#button_hide_entries").click(function(){
        $("#edit_entry").hide();
    });

>>>>>>> 167299c35b3df50037a61277ccea4cc5db38d3e8

    function show_all_entries(data){

        var frameid = document.getElementById("to_be_filled_with_entries");
        if (frameid){
            //var od_tuka = document.getElementById("entry_list_wrapper");
            document.getElementById("entry_list_wrapper").removeChild(frameid)
        }


        document.getElementById("entry_list_wrapper").style.display = "table-cell";
        var iDiv = document.createElement('div');
        iDiv.id = 'to_be_filled_with_entries';
        iDiv.className = 'block';
        document.getElementById("entry_list_wrapper").appendChild(iDiv);


        var data_table = document.createElement('table')

        for (var i = 0, n = data.entry_list.length; i < n; i++)
        {

            var tr = document.createElement('tr');
<<<<<<< HEAD
            tr.id = data.entry_list[i].entry_id;
=======

>>>>>>> 167299c35b3df50037a61277ccea4cc5db38d3e8

            var tdID = tr.appendChild(document.createElement('td'));
            tdID.innerHTML = data.entry_list[i].entry_id;

<<<<<<< HEAD
            //var tdA = tr.appendChild(document.createElement('td'));
            //tdA.innerHTML = data.entry_list[i].entry_name;
            //var tdB = tr.appendChild(document.createElement('td'));
            //tdB.innerHTML = data.entry_list[i].city_name;
            //var tdO = tr.appendChild(document.createElement('td'));
            //tdO.innerHTML = data.entry_list[i].entry_offset;

            var tdAtd = tr.appendChild(document.createElement('td'));
            var tdA = tdAtd.appendChild(document.createElement('input'));
            tdA.type= "text";
            tdA.value = data.entry_list[i].entry_name;

            var tdBtd = tr.appendChild(document.createElement('td'));
            var tdB = tdBtd.appendChild(document.createElement('input'));
            tdB.type= "text";
            tdB.value = data.entry_list[i].city_name;

            var tdOtd = tr.appendChild(document.createElement('td'));
            var tdO = tdOtd.appendChild(document.createElement('input'));
            tdO.type= "time";
            tdO.placeholder="hrs:mins"
            pattern="^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$";
            tdO.value = data.entry_list[i].entry_offset;

=======
            var tdA = tr.appendChild(document.createElement('td'));
            tdA.innerHTML = data.entry_list[i].entry_name;
            var tdB = tr.appendChild(document.createElement('td'));
            tdB.innerHTML = data.entry_list[i].city_name;
            var tdO = tr.appendChild(document.createElement('td'));
            tdO.innerHTML = data.entry_list[i].entry_offset;
>>>>>>> 167299c35b3df50037a61277ccea4cc5db38d3e8
            var tdCU = tr.appendChild(document.createElement('td'));
            tdCU.innerHTML = data.entry_list[i].current_time;
            var tdU = tr.appendChild(document.createElement('td'));
            tdU.innerHTML = data.entry_list[i].user;



            //delte entry button
            var tdE = tr.appendChild(document.createElement('td'));
            var delB_link = tdE.appendChild(document.createElement('input'));
            delB_link.type = "button";
            delB_link.setAttribute("class", "delete-button");
            delB_link.value = "X";
            delB_link.setAttribute("data-url", data.entry_list[i].entry_id);
            somevar = data.entry_list[i].entry_id;
            layout_parent = data_table;
            this_table_row = tr;
<<<<<<< HEAD
            //delB_link.addEventListener('click', function(){delete_entry_func(somevar, this_table_row);}, false);


            delB_link.onclick = function(somevar, this_table_row){
                return function(event){
                        deleteentry(somevar, this_table_row);
                }
            }(somevar, this_table_row)


=======
            delB_link.addEventListener('click', function(){delete_entry_func(somevar, this_table_row);}, false);
>>>>>>> 167299c35b3df50037a61277ccea4cc5db38d3e8

            //edit entry button
            var tdF = tr.appendChild(document.createElement('td'));
            var edit_link = tdF.appendChild(document.createElement('input'));
            edit_link.type = "button";
            edit_link.setAttribute("class", "edit-button");
<<<<<<< HEAD
            edit_link.value = "E" + somevar;
            edit_link.setAttribute("data-url", data.entry_list[i].entry_id);
            edit_link.id = i;

            edit_link.onclick = function(i, somevar, tdA, tdB, tdO){
                return function(event){
                        editentry(i, somevar, tdA, tdB, tdO);
                }
            }(i, somevar, tdA, tdB, tdO)

=======
            edit_link.value = "E";
            edit_link.setAttribute("data-url", data.entry_list[i].entry_id);
            e_name = tdA.textContent;
            c_name = tdB.textContent;
            o_name = tdO.textContent;
            edit_link.addEventListener('click', function(){edit_entry_div_activate(somevar, e_name, c_name, o_name);}, false);
>>>>>>> 167299c35b3df50037a61277ccea4cc5db38d3e8
            data_table.appendChild(tr);
        }

        iDiv.appendChild(data_table);

    }

    $("#button_show_entries").click(function(){

        var filter_text = $("#filter_field").val();

        $.ajax({

            url: '{% url "entry_list" %}',
            type: 'GET',
            data: {'query': filter_text},
            dataType: 'json',
            handleAs: "json",
            statusCode:
            {
                401: function() {console.log("no entries found");},
                200: function() {console.log("entries ok");},
            },

            success: function (data)
            {
                show_all_entries(data);
                $("body").append(data.success);
            },


        });
    });


    $("#button_add_entry").click(function(){

        var entry_name = $("#entry_name").val();
        var city_name = $("#city_name").val();
        var gmt_offset = $("#gmt_offset").val();

        $.ajax({

            url: '{% url "submit_entry" %}',
            type: 'PUT',
            data: {'entry_name': entry_name, 'city_name': city_name, 'gmt_offset': gmt_offset},
            dataType: 'json',
            statusCode:
            {
                401: function() {console.log("no entries found");},
                201: function() {console.log("entry created");},
                405: function() {console.log("method not allowed");},
            },
            success: function (data) {

                show_all_entries(data);
                $("body").append(data.success);

            },
        });
    });

    $("#button_check_city").click(function(){

        var city_name = $("#city_name").val();

        $.ajax({

            url: '{% url "check_city" %}',
            type: 'POST',
            data: {'city_name': city_name},
            dataType: 'json',
            statusCode:
            {
                401: function() {console.log("no entries found");},
                200: function() {console.log("entries ok");},
                405: function() {console.log("method not allowed");},
            },
            success: function (data) {

                alert(data.entry_list);
                $("body").append(data.success);

            },
        });
    });



{% endblock %}

{{% block body %}

<div style="display: table-row;">
<div id="filter_div" class="regular" style="display: table-cell;">
    <input type="text" id='filter_field'>
    <input type="button" class="regular_button" id="button_show_entries" value="view entries">
</div>
<div id="entry_list_wrapper" class = "entries_class" style="display: none;">
    <div id="to_be_filled_with_entries"></div></div>
</div>


<div style="display: table-row;">

<div id="add_entry" class="regular" style="display: table-cell;">

    <p><label>Entry Name</label></p>
    <p><input type="text" id='entry_name' value = ""></p>

    <p><label>City</label></p>
    <p><input type="text" id='city_name' value = ""></p>

    <p><input type="button" class="regular_button" id="button_check_city" value="Check City Help"></p>


    <p><label>Offset</label></p>
    <p><input type="time" id='gmt_offset' placeholder="hrs:mins" pattern="^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$" value = "00:00"></p>


    <p><input type="button" class="regular_button" id="button_add_entry" value="addentry"></p>

</div>


<div id="edit_entry" title="Edit Entry" style="display: none" class="regular">

    <p><label>Entry ID</label></p>
    <p><input type="text" id='edit_entry_id' value = ""></p>

    <p><label>New Entry Name</label></p>
    <p><input type="text" id='edit_entry_name' value = ""></p>

    <p><label>New City Name</label></p>
    <p><input type="text" id='edit_city_name' value = ""></p>

    <p><label>New Offset</label></p>
    <p><input type="time" id='edit_offset' placeholder="hrs:mins" pattern="^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$" value = "00:00"></p>

    <p><input type="button" class="regular_button" id="button_change_entry" value="change entry"></p>
    <p><input type="button" class="regular_button" id="button_hide_entries" value="cancel"></p>

</div>
</div>

{% endblock %}

<!--
<div id="entries_list">

    <h1>Entries</h1>
    {% for entry in user_entries %}
        <p><div id={{entry.id}}>
                <p>
                {{ entry.entry_name }}
                {{ entry.city_name }}
                {{ entry.user }}
                </p>
                <p>
                <table>
                {% for object in entry.tmz.all %}
                    <tr><td>Timezone Name</td><td>{{ object.timezone_name }}</td></tr>
                    <tr><td>Offset</td><td>{{ object.offset }}</td></tr>
                    <tr><td>Local Time</td><td>{{ object.local_time }}</td></tr>
                    <tr><td>Longitude</td><td>{{ object.longitude }}</td></tr>
                    <tr><td>Latitude</td><td>{{ object.latitude }}</td></tr>
                {% endfor %}
                </table>
            <a href="#" class="delete-button" data-url="{% url 'delete_by_id' entry.id %}">Delete {{entry.entry_name}}</a>
        </div>

    {% endfor %}

</div>
-->
